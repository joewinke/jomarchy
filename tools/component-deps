#!/usr/bin/env bash
# Find component dependencies
# Usage: component-deps MediaSelector.svelte
#        component-deps --imports MediaSelector.svelte
#        component-deps --used-by MediaSelector.svelte

if [ "$1" == "--help" ] || [ "$1" == "-h" ] || [ -z "$1" ]; then
  echo "Usage: component-deps <component_file>"
  echo "       component-deps --imports <file>    # What it imports"
  echo "       component-deps --used-by <file>    # What uses it"
  echo ""
  echo "Examples:"
  echo "  component-deps MediaSelector.svelte"
  echo "  component-deps --imports src/lib/components/MediaSelector.svelte"
  echo "  component-deps --used-by MediaSelector.svelte"
  exit 0
fi

if [ "$1" == "--imports" ]; then
  FILE="$2"
  if [ ! -f "$FILE" ]; then
    # Try to find it
    FILE=$(find src -name "$2" -type f | head -1)
    if [ -z "$FILE" ]; then
      echo "✗ File not found: $2"
      exit 1
    fi
  fi
  echo "Imports in $FILE:"
  grep -E "^import.*from" "$FILE" | sed 's/^/  /'
elif [ "$1" == "--used-by" ]; then
  COMPONENT="$2"
  echo "Files that import $COMPONENT:"
  grep -r "import.*$COMPONENT" src --include="*.svelte" --include="*.ts" | cut -d: -f1 | sort -u | sed 's/^/  /'
else
  FILE="$1"
  if [ ! -f "$FILE" ]; then
    # Try to find it
    FILE=$(find src -name "$1" -type f | head -1)
    if [ -z "$FILE" ]; then
      echo "✗ File not found: $1"
      exit 1
    fi
  fi

  echo "=== Component: $FILE ==="
  echo ""
  echo "Imports:"
  grep -E "^import.*from" "$FILE" | sed 's/^/  /' || echo "  (none)"
  echo ""
  echo "Used by:"
  BASENAME=$(basename "$FILE")
  grep -r "import.*$BASENAME" src --include="*.svelte" --include="*.ts" | cut -d: -f1 | sort -u | sed 's/^/  /' || echo "  (none)"
fi
