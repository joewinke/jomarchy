#!/usr/bin/env bash
# Check Supabase migrations status
# Usage: migration-status
#        migration-status --create "add_column_to_table"

if [ "$1" == "--help" ] || [ "$1" == "-h" ]; then
  echo "Usage: migration-status"
  echo "       migration-status --create <name>"
  echo "       migration-status --pending"
  echo ""
  echo "Examples:"
  echo "  migration-status                                    # List all migrations"
  echo "  migration-status --create add_video_batch_table    # Create new migration"
  echo "  migration-status --pending                         # Show pending only"
  exit 0
fi

if [ "$1" == "--create" ]; then
  if [ -z "$2" ]; then
    echo "âœ— Migration name required"
    echo "Usage: migration-status --create <name>"
    exit 1
  fi
  supabase migration new "$2"
elif [ "$1" == "--pending" ]; then
  echo "Checking pending migrations..."
  supabase db diff --schema public
else
  echo "Migration status:"
  supabase migration list
  echo ""
  echo "Local database status:"
  supabase status | grep "DB URL"
fi
