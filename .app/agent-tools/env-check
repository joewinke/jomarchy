#!/usr/bin/env bash
# Verify environment variables
# Usage: env-check
#        env-check --required

if [ "$1" == "--help" ] || [ "$1" == "-h" ]; then
  echo "Usage: env-check [--required]"
  echo ""
  echo "Verify all required environment variables are set"
  echo ""
  echo "Options:"
  echo "  --required    Only check required variables"
  echo ""
  echo "Example:"
  echo "  env-check"
  exit 0
fi

echo "=== Environment Variable Check ==="
echo ""

REQUIRED_VARS=(
  "DATABASE_URL"
  "PUBLIC_SUPABASE_URL"
  "PUBLIC_SUPABASE_ANON_KEY"
  "SUPABASE_SERVICE_ROLE"
)

OPTIONAL_VARS=(
  "OPENAI_API_KEY"
  "SAMBANOVA_API_KEY"
  "RESEND_API_KEY"
  "STRIPE_API_KEY"
  "PUBLIC_STRIPE_PUBLISHABLE_KEY"
)

MISSING=0

echo "Required variables:"
for var in "${REQUIRED_VARS[@]}"; do
  if [ -z "${!var}" ]; then
    echo "  ✗ $var (missing)"
    MISSING=$((MISSING + 1))
  else
    VALUE="${!var}"
    PREVIEW="${VALUE:0:20}..."
    echo "  ✓ $var ($PREVIEW)"
  fi
done

if [ "$1" != "--required" ]; then
  echo ""
  echo "Optional variables:"
  for var in "${OPTIONAL_VARS[@]}"; do
    if [ -z "${!var}" ]; then
      echo "  - $var (not set)"
    else
      VALUE="${!var}"
      PREVIEW="${VALUE:0:20}..."
      echo "  ✓ $var ($PREVIEW)"
    fi
  done
fi

echo ""
if [ $MISSING -gt 0 ]; then
  echo "✗ $MISSING required variables missing"
  exit 1
else
  echo "✓ All required variables set"
fi
